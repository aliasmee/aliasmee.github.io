<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8" />

  
  <title>åˆ©ç”¨å¼€æºè½¯ä»¶strongSwanå®ç°æ”¯æŒIKEv2çš„ä¼ä¸šçº§IPsec VPNï¼Œå¹¶ç»“åˆFreeRadiuså®ç°AAAåè®®(ä¸Šç¯‡)</title>

  
  





  
  <meta name="author" content="aliasmee" />
  <meta name="description" content="åºè¨€:

" />

  
  
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@aliasmeee" />
    <meta name="twitter:title" content="åˆ©ç”¨å¼€æºè½¯ä»¶strongSwanå®ç°æ”¯æŒIKEv2çš„ä¼ä¸šçº§IPsec VPNï¼Œå¹¶ç»“åˆFreeRadiuså®ç°AAAåè®®(ä¸Šç¯‡)" />
    <meta name="twitter:description" content="åºè¨€:

" />
    <meta name="twitter:image" content="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/cover.png" />
  

  
  <meta property="og:type" content="article" />
  <meta property="og:title" content="åˆ©ç”¨å¼€æºè½¯ä»¶strongSwanå®ç°æ”¯æŒIKEv2çš„ä¼ä¸šçº§IPsec VPNï¼Œå¹¶ç»“åˆFreeRadiuså®ç°AAAåè®®(ä¸Šç¯‡)" />
  <meta property="og:description" content="åºè¨€:

" />
  <meta property="og:url" content="https://aliasmee.github.io/post/ikev2-vpn-part1/" />
  <meta property="og:image" content="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/cover.png" />




<meta name="generator" content="Hugo 0.41" />


<link rel="canonical" href="https://aliasmee.github.io/post/ikev2-vpn-part1/" />
<link rel="alternative" href="https://aliasmee.github.io/index.xml" title="aliasmee&#39;s blog " type="application/atom+xml" />


<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="format-detection" content="telephone=no,email=no,adress=no" />
<meta http-equiv="Cache-Control" content="no-transform" />


<meta name="robots" content="index,follow" />
<meta name="referrer" content="origin-when-cross-origin" />
<meta name="google-site-verification" content="dOpqXJeKRrCfsEkfUcoR0Ys0_e1wZ_-sZi_zoDpoc_c" />






<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="aliasmee&#39;s blog " />
<meta name="msapplication-tooltip" content="aliasmee&#39;s blog " />
<meta name='msapplication-navbutton-color' content="#5fbf5e" />
<meta name="msapplication-TileColor" content="#5fbf5e" />
<meta name="msapplication-TileImage" content="/img/tile-image-windows.png" />
<link rel="icon" href="https://aliasmee.github.io/img/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="https://aliasmee.github.io/img/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="https://aliasmee.github.io/img/favicon-32x32.png" />
<link rel="icon" sizes="192x192" href="https://aliasmee.github.io/img/touch-icon-android.png" />
<link rel="apple-touch-icon" href="https://aliasmee.github.io/img/touch-icon-apple.png" />
<link rel="mask-icon" href="https://aliasmee.github.io/img/safari-pinned-tab.svg" color="#5fbf5e" />



<link rel="stylesheet" href="//cdn.bootcss.com/video.js/6.2.8/alt/video-js-cdn.min.css" />

<link rel="stylesheet" href="https://aliasmee.github.io/css/bundle.ff02473a9a.css" />


  
  <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <script src="//cdn.bootcss.com/video.js/6.2.8/ie8/videojs-ie8.min.js"></script>
  <![endif]-->

<!--[if lte IE 11]>
    <script src="//cdn.bootcss.com/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->


<script src="//cdn.bootcss.com/object-fit-images/3.2.3/ofi.min.js"></script>


<script src="//cdn.bootcss.com/smooth-scroll/12.1.4/js/smooth-scroll.polyfills.min.js"></script>


</head>
  <body>
    
    <div class="suspension">
      <a title="Go to top" class="to-top is-hide"><span class="icon icon-up"></span></a>
      
        
        <a title="Go to comments" class="to-comment" href="#disqus_thread"><span class="icon icon-comment"></span></a>
        
      
    </div>
    
    
  <header class="site-header">
  <img class="avatar" src="https://aliasmee.github.io/img/avatar.jpg" alt="Avatar">
  
  <h2 class="title">aliasmee&#39;s blog </h2>
  
  <p class="subtitle">~ Stay Hungry,Stay Foolish. ~</p>
  <button class="menu-toggle" type="button">
    <span class="icon icon-menu"></span>
  </button>
  <nav class="site-menu collapsed">
    <h2 class="offscreen">Main Menu</h2>
    <ul class="menu-list">
      
      
      
      
        <li class="menu-item
            
            
            
              is-active
            ">
            <a href="https://aliasmee.github.io/">æ–‡å­—</a>
          </li>
      
        <li class="menu-item
            
            
            ">
            <a href="https://github.com/aliasmee">GitHub</a>
          </li>
      
        <li class="menu-item
            
            
            ">
            <a href="https://aliasmee.github.io/tags/">Tags</a>
          </li>
      
        <li class="menu-item
            
            
            ">
            <a href="https://aliasmee.github.io/about/">About</a>
          </li>
      
    </ul>
  </nav>
  <nav class="social-menu collapsed">
    <h2 class="offscreen">Social Networks</h2>
    <ul class="social-list">

      
      <li class="social-item">
        <a href="mailto:name@domain.com" title="Email"><span class="icon icon-email"></span></a>
      </li>

      
      <li class="social-item">
        <a href="//github.com/aliasmee" title="GitHub"><span class="icon icon-github"></span></a>
      </li>

      <li class="social-item">
        <a href="//twitter.com/aliasmeee" title="Twitter"><span class="icon icon-twitter"></span></a>
      </li>

      

      

      

      

      

      

      

      

      

      

      

      

      

      <li class="social-item">
        <a href="https://aliasmee.github.io/img/qrcode.jpg" title="Wechat"><span class="icon icon-wechat"></span></a>
      </li>

      <li class="social-item">
        <a href="//www.linkedin.com/in/linkedin_username" title="Linkedin"><span class="icon icon-linkedin"></span></a>
      </li>

      

      

      

      <li class="social-item">
        <a href="https://aliasmee.github.io/index.xml"><span class="icon icon-rss" title="RSS"></span></a>
      </li>

    </ul>
  </nav>
</header>

  <section class="main post-detail">
    <header class="post-header">
      <h1 class="post-title">åˆ©ç”¨å¼€æºè½¯ä»¶strongSwanå®ç°æ”¯æŒIKEv2çš„ä¼ä¸šçº§IPsec VPNï¼Œå¹¶ç»“åˆFreeRadiuså®ç°AAAåè®®(ä¸Šç¯‡)</h1>
      <p class="post-meta">@aliasmee Â· Dec 9, 2016 Â· 5 min read</p>
    </header>
    <article class="post-content"><p>åºè¨€:</p>

<p></p>

<h3 id="æ•…äº‹æ˜¯è¿™æ ·å¼€å§‹çš„">æ•…äº‹æ˜¯è¿™æ ·å¼€å§‹çš„</h3>

<p>ã€€å‰æ®µæ—¶é—´ï¼Œç»™Macå‡çº§äº†ç³»ç»Ÿçš„ï¼Œæ°å·§åœ¨å¹³å¸¸åŠå…¬è¿˜éœ€ç”¨åˆ°æ‹¨VPNçš„ç”¨æˆ·ï¼Œæƒ³å¿…ä¹ŸçŸ¥é“æ–°çš„Macç³»ç»Ÿé‡Œå·²ç»ä¸å†æ”¯æŒPPTPäº†ã€‚è€Œæ˜¯åªæ”¯æŒl2tp,ikev2,ipscè¿™äº›åè®®è¯¦æƒ…å¯ä»¥ç‚¹å‡»è¿™é‡Œï¼šå®˜æ–¹å»ºè®®ã€‚å·§çš„æ˜¯æˆ‘ä»¬çš„vpnå°±æ˜¯pptpçš„&hellip;,è€Œä¸”é¢†å¯¼ä»¬ä¹Ÿéƒ½å‡çº§äº†ç³»ç»Ÿï¼Œæ‚²å‰§äº†å§ã€‚æƒ³æƒ³å‡çº§æ–¹æ¡ˆå§ã€‚æœ¬æ¥æ˜¯å‡†å¤‡ä½¿ç”¨l2tp+ipsecçš„ï¼Œä½†åæ¥åœ¨æ­å»ºå¥½åï¼Œç”¨å®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•æ—¶å´ä¸€ç›´å‡ºç°809é”™è¯¯ã€‚æ­¤åˆ»ï¼Œæœ‰ç§é¦™è‡çš„æ„Ÿè§‰&hellip;</p>

<p>ã€€ä¸è¿‡æƒ³åˆ°äº†macä¸Šé¢è¿˜æœ‰ä¸ªIKEv2çš„vpnç±»å‹ï¼Œå½“æ—¶æ˜¯ç—…æ€¥ä¹±æŠ•åŒ»çš„æ„Ÿè§‰ï¼Œå…¶å®ƒæ–¹æ¡ˆéƒ½ä¸å¯ç”¨ï¼Œè¯•è¯•è¿™ä¸ªå§ï¼Œäºæ˜¯GGæœäº†ç›¸å…³èµ„æ–™ï¼Œä¹Ÿçœ‹äº†å®˜æ–¹ä»‹ç»ï¼Œä»¥åŠå‰è¾ˆå¤§ç‰›ä»¬çš„æ­å»ºæ–‡ç« ï¼Œå°±åƒæ˜¯éƒ‘å’Œå‘ç°æ–°å¤§é™†ä¸€æ ·çš„å¿ƒæƒ…ã€‚è¿™ä¸ªäº†ä¸å¾—å‘€ï¼Œè€Œä¸”å®Œå…¨ä¸ç”¨å®‰è£…ç‰¹æ®Šå®¢æˆ·ç«¯å•Šï¼Œå¤šå¥½çš„æœåŠ¡å‘€ã€‚å¥½å§ï¼Œå°‘ä¸€ç‚¹çœŸè¯šï¼Œå¤šä¸€ç‚¹å¥—è·¯ã€‚åœ¨æ•´ä¸ªå­¦ä¹ æ­å»ºåˆ°åæœŸå®ç°ï¼Œæµ‹è¯•æ•´å¥—æ–¹æ¡ˆçš„è¿‡ç¨‹ï¼Œä¾¿æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚å¦‚æœæœ‰éœ€è¦æ”¹æ­£çš„ï¼Œè¯·ä¸€å®šç•™è¨€å‘Šè¯‰æˆ‘å“ˆã€‚</p>

<h3 id="strongswanè‡ªè¿°">strongSwanè‡ªè¿°</h3>


<figure>
    
        <img src="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/01.png" alt="strongSwan" width="450" />
    
    
    <figcaption>
        <h4>strongSwan</h4>
        
    </figcaption>
    
</figure>


<p>ã€€strongSwanæ˜¯ä¸€ä¸ªå¼€æºçš„IPsecå®ç°é¡¹ç›®ã€‚å®ƒæœ€åˆæ˜¯åŸºäºåœäº§çš„FreeS / WANé¡¹ç›®(è¿™é‡Œæœ‰ä»‹ç»)ï¼Œæˆ‘ä»¬å¼€å‘äº†X.509è¡¥ä¸ã€‚ä¸ºäº†æœ‰ä¸€ä¸ªç¨³å®šçš„IPsecå¹³å°ï¼Œç«‹è¶³äºX.509èƒ½åŠ›çš„æ‰©å±•ï¼Œæˆ‘ä»¬å†³å®šåœ¨2005å¹´å¯åŠ¨strongSwané¡¹ç›®ã€‚</p>

<p>ã€€è‡³æ­¤ï¼Œæ–°çš„IKEå®ˆæŠ¤ç¨‹åºä½¿ç”¨ç°ä»£åŒ–é¢å‘å¯¹è±¡çš„ç¼–ç é£æ ¼ç¼–å†™ï¼Œä½¿å½“å‰çš„ä»£ç å·²ç»ä¸åœ¨å’Œå®ƒçš„ç¥–å…ˆå…±äº«ã€‚æœ€åˆçš„å®ˆæŠ¤è¿›ç¨‹ä»…æ”¯æŒIKEv2åè®®ï¼Œè€ŒIKEv1åˆ™æ˜¯ç”±è¢«FreeS / WANçš„ pluto å®ˆæŠ¤ç¨‹åºçš„æ‰©å±•ç‰ˆæœ¬å¤„ç†ã€‚ä½†æ˜¯ï¼Œç”±äºå…¶ä»–å‚å•†ä¾ç„¶é•¿æœŸé‡‡ç”¨IKEv2åè®®ï¼Œåæ¥åœ¨strongSwan 5.0.0ç‰ˆæœ¬æ—¶ï¼Œä¾¿å¢åŠ äº†IKEv1çš„æ”¯æŒï¼ŒåŠ å…¥åˆ°æ–°çš„å®ˆæŠ¤ç¨‹åºã€‚</p>

<p>strongSwanæœ€åˆè®¾è®¡ç”¨äºLinuxä¸Šï¼Œç°åœ¨å·²ç»è¢«ç§»æ¤åˆ°Androidï¼ŒFreeBSDï¼ŒMac OS Xï¼ŒWindowsç­‰å¹³å°ä¸Šã€‚</p>

<p>strongSwançš„ç‰¹ç‚¹ï¼š</p>

<ul>
<li>é…ç½®ç®€å•</li>
<li>å¼ºå¤§çš„åŠ å¯†å’Œèº«ä»½éªŒè¯æ–¹æ³•</li>
<li>å¼ºå¤§çš„IPsecç­–ç•¥ï¼Œæ”¯æŒå¤§å‹å’Œå¤æ‚çš„VPNç½‘ç»œ</li>
<li>æ¨¡å—åŒ–è®¾è®¡ï¼Œæå¤§çš„æ‰©å±•æ€§</li>
<li>æ”¯æŒMOBIKEï¼Œå¯¹äºç§»åŠ¨ç«¯ï¼Œå¦‚æ‰‹æœºï¼Œæ”¯æŒç‰¹åˆ«å¥½ï¼Œæ®è¯´æ˜¯å³æ—¶åœ¨ç½‘ç»œå¾ˆå·®çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¸ä¼šæ‰çº¿</li>
<li>StrongSwané¡¹ç›®çš„ç»´æŠ¤è€…ï¼šAndreas Steffen.</li>
</ul>

<p>æ”¯æŒçš„å®¢æˆ·ç«¯ï¼š</p>

<ul>
<li>Linux: å‘½ä»¤è¡Œå®¢æˆ·ç«¯å°±æ˜¯ strongSwan æœ¬èº«ï¼Œå› æ­¤å®Œç¾å…¼å®¹ï¼Œæ”¯æŒ ikev1/ikev2 å’Œæ‰€æœ‰åŠ å¯†æ–¹æ³•çš„è¿æ¥ã€‚</li>
<li>Android: åªæ”¯æŒ ikev1(æ²¡æœ‰æœ€æ–°andriodæ‰‹æœºï¼Œå¯èƒ½å·²ç»æ”¯æŒikev2)ã€‚</li>
<li>iOS/Mac OS X:IOS 9 Mac OS X ã€macOS Sierraæ”¯æŒikev2.</li>
<li>Windows: Windows 7 ä»¥åéƒ½æ”¯æŒikev2</li>
</ul>

<h3 id="å¼€å§‹åŠ¨åˆ€å§">å¼€å§‹åŠ¨åˆ€å§</h3>

<ol>
<li>ç¯å¢ƒæ¶æ„ï¼šå¯å‚è€ƒä¸‹å›¾

<figure>
    
        <img src="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/02.png" alt="Topology" width="700" />
    
    
    <figcaption>
        <h4>arch Topology</h4>
        
    </figcaption>
    
</figure>
</li>
</ol>

<blockquote>
<p>ç³»ç»Ÿï¼šCentos7.0 minimal</p>

<p>å…¬ç½‘IP: 192.168.30.57ï¼ˆæ ¹æ®å®é™…æ›´æ”¹ï¼‰</p>

<p>ä½¿ç”¨IKEv2åè®®ï¼Œå®¢æˆ·ç«¯è®¤è¯æ–¹å¼ä½¿ç”¨ ç”¨æˆ·å+å¯†ç  + è¯ä¹¦ ç»“åˆçš„æ–¹å¼ã€‚</p>
</blockquote>

<ol>
<li><p>å®‰è£…å‰é…ç½®ç³»ç»Ÿ</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sed -i <span style="color:#e6db74">&#39;s/SELINUX=enforcing/SELINUX=disabled/g&#39;</span> /etc/selinux/config
setenforce <span style="color:#ae81ff">0</span></code></pre></div></li>

<li><p>æ›´æ–°ç³»ç»Ÿå¹¶å®‰è£…éœ€è¦çš„è½¯ä»¶ç¯å¢ƒ</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">yum update -y
yum install pam-devel openssl-devel make gcc curl tcpdump -y</code></pre></div></li>

<li><p>å®‰è£…æœ€æ–°ç‰ˆstrongSwanè½¯ä»¶</p></li>
</ol>

<p>ä¸‹è½½è§£å‹</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wget -c https://download.strongswan.org/strongswan-5.5.1.tar.gz
tar -xf strongswan-5.5.1.tar.gz <span style="color:#f92672">&amp;&amp;</span> cd strongswan-5.5.1</code></pre></div>
<p>ç¼–è¯‘å‰çš„configureå‚æ•°</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./configure  --enable-eap-identity --enable-eap-md5 <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--enable-eap-mschapv2 --enable-eap-tls --enable-eap-ttls --enable-eap-peap <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--enable-eap-tnc --enable-eap-dynamic --enable-eap-radius --enable-xauth-eap <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--enable-xauth-pam  --enable-dhcp  --enable-openssl  --enable-addrblock --enable-unity <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--enable-certexpire --enable-radattr --enable-swanctl --enable-openssl --disable-gmp</code></pre></div>
<p><code>å¤‡æ³¨ï¼š--enable-eap-radius æ˜¯ä¸ºäº†åæœŸä¸radius ç»“åˆæ—¶æ¨¡å—ï¼Œå¦‚æœä½ çš„radius å’Œipsecä¸èƒ½ä¸€èµ·å·¥ä½œï¼Œå¯æ£€æŸ¥ç¼–è¯‘å®‰è£…æ—¶æœ‰æ²¡æœ‰å¼€å¯è¿™ä¸ªæ¨¡å—ã€‚</code></p>

<p>ç¼–è¯‘å®‰è£…</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">make <span style="color:#f92672">&amp;&amp;</span> make install</code></pre></div>
<ol>
<li><p>ç”Ÿæˆç›¸å…³è¯ä¹¦æ–‡ä»¶ï¼ˆä½¿ç”¨ipsec pkiå‘½ä»¤ï¼‰</p>

<ul>
<li>åˆ›å»ºè¯ä¹¦å­˜æ”¾ç›®å½•
<code>bash
mkdir key_files &amp;&amp; cd key_filesã€€ã€€ã€€ã€€
</code></li>

<li><p>ç”Ÿæˆä¸€ä¸ªæ–°çš„ç§é’¥ï¼Œå¹¶ç”¨æ–°ç§é’¥ç”Ÿæˆä¸€ä¸ªè‡ªç­¾åçš„CAè¯ä¹¦ï¼Œæœ‰æ•ˆæœŸä¸º10å¹´</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ipsec pki --gen --outform pem &gt; ca.pem
ipsec pki --self --in ca.pem --dn <span style="color:#e6db74">&#34;C=cn, O=ilove, CN=VPN CA&#34;</span> --ca --lifetime <span style="color:#ae81ff">3650</span> --outform pem &gt;ca.cert.pem</code></pre></div>
<p>å¤‡æ³¨ï¼šC è¡¨ç¤ºå›½å®¶ï¼ŒO è¡¨ç¤ºç»„ç»‡åï¼Œå¦‚gugeã€‚CN ä¸ºé€šç”¨åã€‚ï¼ˆåœ¨æ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹ä¸­è¦ä¿æŒä¸€è‡´ï¼‰</p></li>

<li><p>ç”Ÿæˆä¸€ä¸ªæ–°çš„ç§é’¥ï¼Œåˆ›å»ºæœåŠ¡å™¨è¯ä¹¦æ—¶éœ€è¦ã€‚ç„¶åä»åˆšç”Ÿæˆçš„ç§é’¥ä¸­æå–å…¬é’¥ï¼Œä½¿ç”¨ä¸Šä¸€æ­¥è‡ªç­¾åçš„CAè¯ä¹¦æ–‡ä»¶ï¼Œé¢å‘ä¸€ä¸ªæœåŠ¡å™¨è¯ä¹¦</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ipsec pki --gen --outform pem &gt; server.pem
ipsec pki --pub --in server.pem | ipsec pki --issue --lifetime <span style="color:#ae81ff">1200</span> --cacert ca.cert.pem --cakey ca.pem --dn <span style="color:#e6db74">&#34;C=cn, O=ilove, CN=192.168.30.57&#34;</span> --san<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;192.168.30.57&#34;</span> --flag serverAuth --flag ikeIntermediate --outform pem &gt; server.cert.pem</code></pre></div>
<p><code>å¤‡æ³¨ï¼š--CN=192.168.30.57 --san=192.168.30.57   å¯ä»¥æ›¿æ¢æˆä½ çš„å…¬ç½‘ip</code></p></li>

<li><p>ç”Ÿæˆä¸€ä¸ªæ–°çš„ç§é’¥ï¼Œå¹¶ç”¨ä¸Šä¸€æ­¥è‡ªç­¾åçš„CAè¯ä¹¦é¢å‘ä¸€ä¸ªå®¢æˆ·ç«¯è¯ä¹¦</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ipsec pki --gen --outform pem &gt; client.pem
ipsec pki --pub --in client.pem | ipsec pki --issue --cacert ca.cert.pem --cakey ca.pem --dn <span style="color:#e6db74">&#34;C=cn, O=ilove, CN=VPN Client&#34;</span> --outform pem &gt; client.cert.pem</code></pre></div>
<p><code>å¤‡æ³¨ï¼šè¿™é‡Œå®¢æˆ·ç«¯çš„è¯ä¹¦å¯ä»¥å’Œca è¯ä¹¦ä¸ä¸€æ ·ã€‚</code></p></li>
</ul></li>

<li><p>å°†ç”Ÿæˆçš„è¯ä¹¦æ–‡ä»¶æ‹·è´åˆ°strongswanç¨‹åºä¸­çš„ç›¸å…³ç›®å½•ä¸­</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cp ca.cert.pem /usr/local/etc/ipsec.d/cacerts/
cp server.cert.pem /usr/local/etc/ipsec.d/certs/
cp server.pem /usr/local/etc/ipsec.d/private/
cp client.cert.pem /usr/local/etc/ipsec.d/certs/
cp client.pem  /usr/local/etc/ipsec.d/private/</code></pre></div></li>

<li><p>é…ç½®strongSwan IPsecæœåŠ¡</p>

<ul>
<li>é…ç½®ipsecï¼Œæ–‡ä»¶åœ¨/usr/local/etc/ipsec.conf,å†…å®¹å¦‚ä¸‹</li>
</ul></li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># cat /usr/local/etc/ipsec.conf
</span><span style="color:#75715e"></span>config setup
    uniqueids<span style="color:#f92672">=</span>never 

conn iOS_cert
    keyexchange<span style="color:#f92672">=</span>ikev1
    fragmentation<span style="color:#f92672">=</span>yes
    left<span style="color:#f92672">=</span>%defaultroute
    leftauth<span style="color:#f92672">=</span>pubkey
    leftsubnet<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.0.0.0/0
    leftcert<span style="color:#f92672">=</span>server.cert.pem
    right<span style="color:#f92672">=</span>%any
    rightauth<span style="color:#f92672">=</span>pubkey
    rightauth2<span style="color:#f92672">=</span>xauth
    rightsourceip<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>.31.0.0/24
    rightcert<span style="color:#f92672">=</span>client.cert.pem
    auto<span style="color:#f92672">=</span>add

conn android_xauth_psk
    keyexchange<span style="color:#f92672">=</span>ikev1
    left<span style="color:#f92672">=</span>%defaultroute
    leftauth<span style="color:#f92672">=</span>psk
    leftsubnet<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.0.0.0/0
    right<span style="color:#f92672">=</span>%any
    rightauth<span style="color:#f92672">=</span>psk
    rightauth2<span style="color:#f92672">=</span>xauth
    rightsourceip<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>.31.1.0/24
    auto<span style="color:#f92672">=</span>add

conn networkmanager-strongswan
    keyexchange<span style="color:#f92672">=</span>ikev2
    left<span style="color:#f92672">=</span>%defaultroute
    leftauth<span style="color:#f92672">=</span>pubkey
    leftsubnet<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.0.0.0/0
    leftcert<span style="color:#f92672">=</span>server.cert.pem
    right<span style="color:#f92672">=</span>%any
    rightauth<span style="color:#f92672">=</span>pubkey
    rightsourceip<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>.31.2.0/24
    rightcert<span style="color:#f92672">=</span>client.cert.pem
    auto<span style="color:#f92672">=</span>add

conn ios_ikev2
    keyexchange<span style="color:#f92672">=</span>ikev2
    ike<span style="color:#f92672">=</span>aes256-sha256-modp2048,3des-sha1-modp2048,aes256-sha1-modp2048!
    esp<span style="color:#f92672">=</span>aes256-sha256,3des-sha1,aes256-sha1!
    rekey<span style="color:#f92672">=</span>no
    left<span style="color:#f92672">=</span>%defaultroute
    leftid<span style="color:#f92672">=</span><span style="color:#ae81ff">192</span>.168.30.57
    leftsendcert<span style="color:#f92672">=</span>always
    leftsubnet<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.0.0.0/0
    leftcert<span style="color:#f92672">=</span>server.cert.pem
    right<span style="color:#f92672">=</span>%any
    rightauth<span style="color:#f92672">=</span>eap-mschapv2
    rightsourceip<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>.31.2.0/24
    rightsendcert<span style="color:#f92672">=</span>never
    eap_identity<span style="color:#f92672">=</span>%any
    dpdaction<span style="color:#f92672">=</span>clear
    fragmentation<span style="color:#f92672">=</span>yes
    auto<span style="color:#f92672">=</span>add

conn windows7
    keyexchange<span style="color:#f92672">=</span>ikev2
    ike<span style="color:#f92672">=</span>aes256-sha1-modp1024!
    rekey<span style="color:#f92672">=</span>no
    left<span style="color:#f92672">=</span>%defaultroute
    leftauth<span style="color:#f92672">=</span>pubkey
    leftsubnet<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.0.0.0/0
    leftcert<span style="color:#f92672">=</span>server.cert.pem
    right<span style="color:#f92672">=</span>%any
    rightauth<span style="color:#f92672">=</span>eap-mschapv2
    rightsourceip<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>.31.2.0/24
    rightsendcert<span style="color:#f92672">=</span>never
    eap_identity<span style="color:#f92672">=</span>%any
    auto<span style="color:#f92672">=</span>add</code></pre></div>
<p><code>å¤‡æ³¨ï¼šã€€æ³¨æ„ï¼šleftid è¦æ”¹ä¸ºä½ è‡ªå·±çš„å…¬ç½‘IPï¼Œåˆ‡è®°ã€‚</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">config setup æ‰€æœ‰é¡¹ç›®å…±ç”¨é…ç½®é¡¹
uniqueids<span style="color:#f92672">=</span>never å…è®¸å¤šä¸ªå®¢æˆ·ç«¯ä½¿ç”¨åŒä¸€è¯ä¹¦ï¼Œå³å¤šè®¾å¤‡åŒæ—¶åœ¨çº¿
conn ios_ikev2 å®šä¹‰ä¸€ä¸ªè¿æ¥æ ‡è¯†ï¼Œç”¨äºipsec status æŸ¥çœ‹è¿æ¥æ—¶æœ‰æ‰€åŒºåˆ«
left<span style="color:#f92672">=</span>%any     æœåŠ¡å™¨ç«¯æ ‡è¯†,%anyè¡¨ç¤ºä»»æ„
leftsubnet<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>.0.0.0/0 æœåŠ¡å™¨ç«¯è™šæ‹Ÿip, <span style="color:#ae81ff">0</span>.0.0.0/0è¡¨ç¤ºé€šé….
right<span style="color:#f92672">=</span>%any   å®¢æˆ·ç«¯æ ‡è¯†,%anyè¡¨ç¤ºä»»æ„
leftcert<span style="color:#f92672">=</span>server.cert.pem   æœåŠ¡å™¨ç«¯è¯ä¹¦
rightsourceip<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>.31.2.0/24     åˆ†é…ç»™å®¢æˆ·ç«¯çš„è™šæ‹Ÿipæ®µ
leftid<span style="color:#f92672">=</span><span style="color:#ae81ff">192</span>.168.30.57  è¿™é‡Œé€‰æ‹©ä½ çš„ipåœ°å€ã€‚å¿…é¡»å’Œè¯ä¹¦é‡Œå¡«å†™çš„ä¸€è‡´ã€‚
ike å¯†é’¥äº¤æ¢ç®—æ³•</code></pre></div>
<p>è¯¦ç»†çš„ipsec.conf è¯·å‚è€ƒå®˜ç½‘</p>

<ul>
<li>é…ç½®strongSwan é…ç½®æ–‡ä»¶ï¼Œè·¯å¾„åœ¨/usr/local/etc/strongswan.confï¼Œæ–‡ä»¶å†…å®¹:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat /usr/local/etc/strongswan.conf
charon <span style="color:#f92672">{</span>
        load_modular <span style="color:#f92672">=</span> yes
        duplicheck.enable <span style="color:#f92672">=</span> no
        compress <span style="color:#f92672">=</span> yes
        plugins <span style="color:#f92672">{</span>
                include strongswan.d/charon/*.conf
        <span style="color:#f92672">}</span>
        dns1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">114</span>.114.114.114
        dns2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>.8.8.8
        nbns1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>.8.8.8
        nbns2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>.8.4.4
<span style="color:#f92672">}</span>
include strongswan.d/*.conf</code></pre></div>
<p><code>å¤‡æ³¨ï¼š</code></p>

<pre><code>Duplicheck.enable = no    å…³é—­å†—ä½™æ£€æŸ¥ï¼ŒåŒæ—¶è¿æ¥å¤šä¸ªè®¾å¤‡
plugins strongswan æ”¯æŒçš„æ’ä»¶é…ç½®ï¼Œä¸å»ºè®®åœ¨æ­¤æ–‡ä»¶é‡Œé…ç½®ï¼Œåº”å»charonç›®å½•ä¸‹ã€‚
</code></pre>

<ul>
<li>é…ç½®vpnè®¤è¯å¯†ç æ–‡ä»¶ipsec.secrets,ï¼Œè·¯å¾„/usr/local/etc/ipsec.secretsï¼Œå†…å®¹å¦‚ä¸‹</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat /usr/local/etc/ipsec.secrets
: RSA server.pem
: PSK <span style="color:#e6db74">&#34;iloveworld&#34;</span>
: XAUTH <span style="color:#e6db74">&#34;iloveworldPass&#34;</span>
testUserOne %any : EAP <span style="color:#e6db74">&#34;testOnePass&#34;</span></code></pre></div>
<p><code>å¤‡æ³¨ï¼š</code></p>

<pre><code>RSA  æœåŠ¡å™¨çš„ç§é’¥
PSK  å…±äº«å¯†é’¥ï¼ˆå¯ç”¨äºios 10ä¸Šç›´æ¥ä½¿ç”¨Ciscoçš„ IPSecè¿æ¥ï¼‰
testUserOne æ˜¯ç”¨æˆ·åï¼Œ testOnePass æ˜¯ç”¨æˆ·åå¯†ç ï¼Œå¯å¡«å†™å¤šè¡Œï¼Œæ·»åŠ å¤šä¸ªç”¨æˆ·æ—¶ï¼Œéœ€è¦é‡å¯ipsec
</code></pre>

<ol>
<li>é…ç½®linuxç³»ç»Ÿå†…æ ¸å¼€å¯è½¬å‘åŠŸèƒ½ï¼Œå¹¶é…ç½®iptablesè§„åˆ™</li>
</ol>

<p>8.1 å¼€å¯å†…æ ¸è½¬å‘ï¼Œæš‚æ—¶ç”Ÿæ•ˆï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sysctl -w net.ipv4.ip_forward<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span></code></pre></div>
<p>æˆ–è€…è®©å…¶æ°¸ä¹…ç”Ÿæ•ˆï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">echo <span style="color:#e6db74">&#34;net.ipv4.ip_forward = 1&#34;</span> &gt;&gt; /etc/sysctl.conf
sysctl -p</code></pre></div>
<p>8.2 æ·»åŠ iptables è§„åˆ™</p>

<p>å…ˆæ¸…é™¤åŸæœ‰è§„åˆ™ï¼ˆçº¿ä¸Šçš„è¯å»ºè®®å…ˆå¤‡ä»½ï¼Œå¹¶ä¿è¯22ç«¯å£å¯è¿æ¥ï¼Œæ­¤æ­¥éª¤å¯ä¸åšã€‚ï¼‰</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">iptables -F
iptables -X</code></pre></div>
<p>è½¬å‘è§„åˆ™</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">iptables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -s <span style="color:#ae81ff">10</span>.31.0.0/24  -j ACCEPT
iptables -A FORWARD -s <span style="color:#ae81ff">10</span>.31.1.0/24  -j ACCEPT
iptables -A FORWARD -s <span style="color:#ae81ff">10</span>.31.2.0/24  -j ACCEPT</code></pre></div>
<p>å…¥ç«™è§„åˆ™ï¼ˆæ³¨æ„ï¼š-i ä½ çš„ç½‘å¡åç§°ï¼‰</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">iptables -A INPUT -i eno16777984 -p esp -j ACCEPT
iptables -A INPUT -i eno16777984 -p udp -m state --state NEW --dport <span style="color:#ae81ff">500</span> -j ACCEPT
iptables -A INPUT -i eno16777984 -p udp -m state --state NEW --dport <span style="color:#ae81ff">4500</span> -j ACCEPT
iptables -A INPUT -i eno16777984 -p udp -m state --state NEW --dport <span style="color:#ae81ff">1701</span> -j ACCEPT
iptables -A INPUT -i eno16777984 -p tcp -m state --state NEW --dport <span style="color:#ae81ff">1723</span> -j ACCEPT</code></pre></div>
<p>Natè§„åˆ™</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">iptables -t nat -A POSTROUTING -s <span style="color:#ae81ff">10</span>.31.0.0/24 -o eno16777984 -j MASQUERADE
iptables -t nat -A POSTROUTING -s <span style="color:#ae81ff">10</span>.31.1.0/24 -o eno16777984 -j MASQUERADE
iptables -t nat -A POSTROUTING -s <span style="color:#ae81ff">10</span>.31.2.0/24 -o eno16777984 -j MASQUERADE</code></pre></div>
<p>ä¿å­˜iptablesè§„åˆ™</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">service iptables save</code></pre></div>
<p>å¤‡æ³¨ï¼šåœ¨è¿™ä¸ªç¯å¢ƒé‡Œï¼Œæˆ‘æ˜¯å¸è½½äº†7çš„ firewalldç¨‹åºï¼Œå¹¶å®‰è£…äº†iptables-servicesç¨‹åºã€‚æ³¨æ„ï¼š-i ç½‘å¡åç§°ï¼ˆå¡«å†™ä½ è‡ªå·±çš„ç½‘å¡åç§°ï¼Œ7ä»¥å‰çš„æ˜¯ethxxï¼‰</p>

<p>è¿™é‡Œå®Œæ•´çš„iptables è§„åˆ™ï¼Œå¯ä»¥å‚è€ƒï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat /etc/sysconfig/iptables
*filter
:INPUT ACCEPT <span style="color:#f92672">[</span><span style="color:#ae81ff">0</span>:0<span style="color:#f92672">]</span>
:FORWARD ACCEPT <span style="color:#f92672">[</span><span style="color:#ae81ff">0</span>:0<span style="color:#f92672">]</span>
:OUTPUT ACCEPT <span style="color:#f92672">[</span><span style="color:#ae81ff">342</span>:64390<span style="color:#f92672">]</span>
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport <span style="color:#ae81ff">22</span> -j ACCEPT
-A INPUT -i eno16777984 -p esp -j ACCEPT
-A INPUT -i eno16777984 -p udp -m udp --dport <span style="color:#ae81ff">500</span> -j ACCEPT
-A INPUT -i eno16777984 -p udp -m udp --dport <span style="color:#ae81ff">4500</span> -j ACCEPT
-A INPUT -i eno16777984 -p udp -m udp --dport <span style="color:#ae81ff">1701</span> -j ACCEPT
-A INPUT -i eno16777984 -p tcp -m tcp --dport <span style="color:#ae81ff">1723</span> -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -s <span style="color:#ae81ff">10</span>.31.0.0/24 -j ACCEPT
-A FORWARD -s <span style="color:#ae81ff">10</span>.31.1.0/24 -j ACCEPT
-A FORWARD -s <span style="color:#ae81ff">10</span>.31.2.0/24 -j ACCEPT
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
COMMIT
*nat
:PREROUTING ACCEPT <span style="color:#f92672">[</span><span style="color:#ae81ff">24</span>:10065<span style="color:#f92672">]</span>
:INPUT ACCEPT <span style="color:#f92672">[</span><span style="color:#ae81ff">5</span>:241<span style="color:#f92672">]</span>
:OUTPUT ACCEPT <span style="color:#f92672">[</span><span style="color:#ae81ff">18</span>:1422<span style="color:#f92672">]</span>
:POSTROUTING ACCEPT <span style="color:#f92672">[</span><span style="color:#ae81ff">18</span>:1422<span style="color:#f92672">]</span>
-A POSTROUTING -s <span style="color:#ae81ff">10</span>.31.0.0/24 -o eno16777984 -j MASQUERADE
-A POSTROUTING -s <span style="color:#ae81ff">10</span>.31.1.0/24 -o eno16777984 -j MASQUERADE
-A POSTROUTING -s <span style="color:#ae81ff">10</span>.31.2.0/24 -o eno16777984 -j MASQUERADE
COMMIT</code></pre></div>
<p>9.å¯åŠ¨ipsecç¨‹åº</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ipsec start
Starting strongSwan <span style="color:#ae81ff">5</span>.5.1 IPsec <span style="color:#f92672">[</span>starter<span style="color:#f92672">]</span>...</code></pre></div>
<p>å…¶å®ƒä¸€äº›å¯ç”¨å‘½ä»¤ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ipsec start   <span style="color:#75715e">#å¯åŠ¨æœåŠ¡
</span><span style="color:#75715e"></span>ipsec stop    <span style="color:#75715e">#å…³é—­æœåŠ¡
</span><span style="color:#75715e"></span>ipsec restart <span style="color:#75715e">#é‡å¯æœåŠ¡
</span><span style="color:#75715e"></span>ipsec reload  <span style="color:#75715e">#é‡æ–°è¯»å–
</span><span style="color:#75715e"></span>ipsec status  <span style="color:#75715e">#æŸ¥çœ‹çŠ¶æ€
</span><span style="color:#75715e"></span>ipsec --help  #æŸ¥çœ‹å¸®åŠ©</code></pre></div>
<ol>
<li>æœåŠ¡å™¨å®‰è£…é…ç½®å®Œçš„åŸºæœ¬ä¿¡æ¯</li>
</ol>

<pre><code>VPNæœåŠ¡å™¨ï¼š192.168.30.57
VPNç”¨æˆ·ï¼štestUserOne
VPNå¯†ç ï¼štestOnePass
PSK:       iloveworld
</code></pre>

<p>å®¢æˆ·ç«¯ä½¿ç”¨caè¯ä¹¦ï¼šca.cert.pemï¼ˆå¯ä¿®æ”¹ä¸º.cerç»“å°¾ï¼Œå‘é€ç»™æ¯ä¸ªvpnç”¨æˆ·è¿›è¡Œè¯ä¹¦å®‰è£…ï¼Œåé¢æœ‰å®‰è£…æ­¥éª¤ï¼‰</p>

<h3 id="ç°åœ¨è®©ç”¨æˆ·éªŒè¯å§">ç°åœ¨è®©ç”¨æˆ·éªŒè¯å§</h3>

<ol>
<li>Windows ç”¨æˆ·å®‰è£…æµ‹è¯•</li>
</ol>

<p>å°†ca.cert.pemè¯ä¹¦ä¿®æ”¹åç¼€ä¸º.cerï¼Œç„¶åæ‹·è´åˆ°windowsç³»ç»Ÿä¸­ï¼Œå¹¶å‘½ä»¤è¡Œé‡Œæ‰“å¼€mmcï¼Œæ·»åŠ è¯ä¹¦ç®¡ç†å•å…ƒï¼Œé€‰æ‹©è®¡ç®—æœºè´¦æˆ·ï¼Œä¹‹åç‚¹å‡»å¯¼å…¥è¯¥è¯ä¹¦ï¼Œå¦‚ä¸‹å›¾ï¼š

<figure>
    
        <img src="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/03.png" alt="è¯ä¹¦" width="700" />
    
    
    <figcaption>
        <h4>Windows å¯¼å…¥è¯ä¹¦ç¤ºä¾‹</h4>
        
    </figcaption>
    
</figure>
</p>

<p>æ‰“å¼€ç½‘ç»œå…±äº«ä¸­å¿ƒé¢æ¿ï¼Œæ–°å»ºä¸€ä¸ªVPNè¿æ¥ï¼Œå¦‚ä¸‹å›¾ï¼š

<figure>
    
        <img src="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/04.png" alt="new vpn" width="700" />
    
    
    <figcaption>
        <h4>æ§åˆ¶é¢æ¿</h4>
        
    </figcaption>
    
</figure>
</p>

<p>åˆ›å»ºæ–°è¿æ¥

<figure>
    
        <img src="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/05.png" alt="new vpn" width="700" />
    
    
    <figcaption>
        <h4>åˆ›å»ºæ–°è¿æ¥</h4>
        
    </figcaption>
    
</figure>
</p>

<p>ä½¿ç”¨æˆ‘çš„Internetè¿æ¥</p>


<figure>
    
        <img src="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/06.png" alt="new vpn" width="700" />
    
    
    <figcaption>
        <h4>ä½¿ç”¨æ–°è¿æ¥</h4>
        
    </figcaption>
    
</figure>


<p>è¿™é‡Œé€‰æ‹©ç¨åè¿æ¥ï¼Œå› ä¸ºè¿˜è¦é…ç½®ä¸‹å®‰å…¨é€‰é¡¹ã€‚</p>

<p>è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 

<figure>
    
        <img src="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/08.png" alt="new vpn" width="700" />
    
    
    <figcaption>
        <h4>ç”¨æˆ·åå’Œå¯†ç </h4>
        
    </figcaption>
    
</figure>
</p>

<p>ç‚¹å‡»åˆ›å»ºï¼Œä¹‹åç‚¹å‡»å…³é—­ï¼Œç„¶åå»å³é”®è¯¥è¿æ¥çš„å±æ€§ã€‚ç‚¹å‡»å®‰å…¨ï¼Œä¿®æ”¹vpnç±»å‹ä¸ºIKEv2å¦‚ä¸‹å›¾ï¼š

<figure>
    
        <img src="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/09.png" alt="new vpn" width="700" />
    
    
    <figcaption>
        <h4>å®‰å…¨å±æ€§</h4>
        
    </figcaption>
    
</figure>
</p>

<p>è®¾ç½®å®Œæˆåå°±å¯ä»¥è¿æ¥å•¦ã€‚è¿æ¥å®Œæˆæ£€æŸ¥ä¸‹vpnè¿æ¥çŠ¶æ€ï¼Œå¦‚ä¸‹ï¼š</p>


<figure>
    
        <img src="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/10.png" alt="new vpn" width="700" />
    
    
    <figcaption>
        <h4>é“¾æ¥çŠ¶æ€</h4>
        
    </figcaption>
    
</figure>


<ol>
<li>Mac OS ç”¨æˆ·æµ‹è¯•</li>
</ol>

<p>å…ˆå°†è¯ä¹¦æ‹·è´åˆ°macç³»ç»Ÿå†…ï¼ŒåŒå‡»æ‰“å¼€ã€‚å¦‚ä¸‹ï¼š

<figure>
    
        <img src="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/11.png" alt="new vpn" width="700" />
    
    
    <figcaption>
        <h4>å®‰è£…è¯ä¹¦</h4>
        
    </figcaption>
    
</figure>

<code>æ­¤å¤„æ³¨æ„ ä¿®æ”¹ä½¿ç”¨æ­¤è¯ä¹¦æ—¶: å§‹ç»ˆä¿¡ä»»ã€‚ å¯èƒ½éœ€è¦è¾“å…¥ç³»ç»Ÿç®¡ç†å‘˜çš„å¯†ç ï¼</code></p>

<p>ä¹‹åï¼Œæ‰“å¼€ç½‘ç»œåå¥½è®¾ç½®ï¼Œæ·»åŠ VPNï¼Œå¦‚ä¸‹å›¾ï¼šç±»å‹é€‰æ‹©IKEv2

<figure>
    
        <img src="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/13.png" alt="new vpn" width="700" />
    
    
    <figcaption>
        <h4>VPNç±»å‹</h4>
        
    </figcaption>
    
</figure>
</p>

<p>å†ä¹‹åè¾“å…¥vpnä¿¡æ¯ï¼ŒæœåŠ¡å™¨åœ°å€å’Œè¿œç¨‹IDå‡è¾“å…¥VPNæœåŠ¡å™¨å…¬ç½‘ipï¼Œç‚¹å‡»é‰´å®šè®¾ç½®ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚ç‚¹å‡»è¿æ¥å³å¯

<figure>
    
        <img src="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/14.png" alt="new vpn" width="700" />
    
    
    <figcaption>
        <h4>VPN ç”¨æˆ·åå’Œå¯†ç </h4>
        
    </figcaption>
    
</figure>
</p>

<p>æœ€åæŸ¥çœ‹æœ¬æœºipé…ç½®ï¼Œç±»ä¼¼ä¸‹å›¾ï¼Œå·²ç»è·å¾—ipï¼Œå¹¶ä¸”å¯ä»¥æ­£å¸¸ä¸Šç½‘ã€‚

<figure>
    
        <img src="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/15.png" alt="new vpn" width="700" />
    
    
    <figcaption>
        <h4>é“¾æ¥çŠ¶æ€</h4>
        
    </figcaption>
    
</figure>
</p>

<ol>
<li>iOSå®¢æˆ·ç«¯</li>
</ol>

<p>è¯ä¹¦å®‰è£…:</p>

<p>å°†è¯ä¹¦æ”¾ç½®åœ¨æ‰‹æœºæµè§ˆå™¨å¯ä»¥è®¿é—®ä¸‹è½½çš„åœ°æ–¹ï¼ˆæˆ‘æ˜¯ç›´æ¥åœ¨è¿™ä¸ªvpnæœåŠ¡å™¨å¼€ä¸ª80ï¼Œè®©æ‰‹æœºå»ä¸‹è½½çš„è¯ä¹¦ï¼‰ï¼Œç”¨safariè®¿é—®ï¼Œæ‰“å¼€ï¼Œä¹‹åè¾“å…¥æ‰‹æœºå¯†ç è¿›è¡Œè¯ä¹¦çš„å®‰è£…ã€‚æ·»åŠ VPNæ–¹æ³•å’Œmacç±»ä¼¼ã€‚ä¸åœ¨å™è¿° æ³¨: ios æ‰‹æœºç«¯å¯ä»¥é€‰æ‹©IKEv2ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©IPSecã€‚
IPSecé…ç½®æ–¹å¼å¦‚ä¸‹:

<figure>
    
        <img src="https://aliasmee.github.io/media/posts/ikev2-vpn-part1/16.png" alt="new vpn" width="700" />
    
    
    <figcaption>
        <h4>æ‰‹æœºé…ç½®ipsec</h4>
        
    </figcaption>
    
</figure>
</p>

<p>è¿™é‡Œçš„å¯†é’¥å°±æ˜¯ PSKï¼Œåœ¨å¯†ç è®¤è¯æ–‡ä»¶é‡Œï¼Œè¿™é‡Œçš„PSKå¯†é’¥ä¸º iloveworldï¼ˆæ¨èè®¾ç½®å¤æ‚é«˜å¼ºåº¦ï¼‰OKï¼Œä¸Šé¢å°±æ˜¯è®°å½•æ•´ä¸ªstrongSwanå®‰è£…åˆ°ä½¿ç”¨çš„è¿‡ç¨‹ã€‚æƒ³ç€æ—¢ç„¶vpnå‡çº§äº†ï¼Œæœ¬èº«å°±æ˜¯å¤§å·¥ç¨‹ï¼Œé‚£ä½•ä¸åšå®Œå–„ç‚¹ï¼Ÿ</p>

<p>äºæ˜¯ä¾¿æœ‰äº†è¿™ä¸ª <em>åˆ©ç”¨å¼€æºè½¯ä»¶strongSwanå®ç°æ”¯æŒIKEv2çš„ä¼ä¸šçº§IPsec VPNï¼Œå¹¶ç»“åˆFreeRadiuså®ç°AAAåè®®(ä¸‹ç¯‡)</em>, æˆ‘æ“¦ï¼Œè¿™åå­—çœŸé•¿ï¼ŒçœŸä¸çŸ¥é“æˆ‘æ˜¯æ€ä¹ˆæƒ³å‡ºæ¥çš„ ğŸ’£&hellip;.</p>

<p>ä¸‹ç¯‡æ–‡ç« çš„å†…å®¹ï¼Œè®°å½•çš„ä¸»è¦æ˜¯åˆ©ç”¨freeradius è½¯ä»¶æ¥å®ç°radiusçš„ 3Aï¼ˆå³è®¤è¯ã€æˆæƒã€è®¡è´¹ï¼‰åŠŸèƒ½ï¼Œå¹¶ç»“åˆDaloRadiusè¿›è¡Œwebç®¡ç†ã€‚ï¼ˆdaloradius çš„webç•Œé¢æœ‰å‡ å¤„ä¸centos7 ç³»ç»Ÿç®—æ˜¯ä¸å…¼å®¹å§ï¼Œæˆ‘å¯¹phpçš„ä¸ªåˆ«é¡µé¢è¿›è¡Œäº†ä¿®æ”¹ï¼‰ã€‚è¿‡å‡ å¤©å‘ä¸‹ç¯‡å§ã€‚åˆ°æ—¶å¤§å®¶å†ç»†çœ‹å§ã€‚</p>

<h3 id="å‚è€ƒ">å‚è€ƒ</h3>

<p><a href="https://www.strongswan.org/blog/2016/10/21/strongswan-5.5.1-released.html">https://www.strongswan.org/blog/2016/10/21/strongswan-5.5.1-released.html</a></p>

<p><a href="https://wiki.strongswan.org/projects/strongswan/wiki/IpsecPKI">https://wiki.strongswan.org/projects/strongswan/wiki/IpsecPKI</a></p>

<p><a href="https://www.lowendtalk.com/discussion/44964/vpn-everywhere-ipsec-without-l2tp-with-strongswan-even-in-openvz">https://www.lowendtalk.com/discussion/44964/vpn-everywhere-ipsec-without-l2tp-with-strongswan-even-in-openvz</a></p>

<p><a href="https://libreswan.org/">https://libreswan.org/</a></p>

<p><a href="https://wiki.strongswan.org/projects/strongswan/wiki/Win7Certs">https://wiki.strongswan.org/projects/strongswan/wiki/Win7Certs</a></p>

<p><a href="https://wiki.strongswan.org/projects/strongswan/wiki/Win7Config">https://wiki.strongswan.org/projects/strongswan/wiki/Win7Config</a></p>

<p><a href="https://wiki.strongswan.org/projects/strongswan/wiki/Win7Connect">https://wiki.strongswan.org/projects/strongswan/wiki/Win7Connect</a></p>

<p><a href="https://wiki.strongswan.org/projects/strongswan/wiki/WindowsVista">https://wiki.strongswan.org/projects/strongswan/wiki/WindowsVista</a></p>

<p><a href="https://wiki.strongswan.org/projects/strongswan/wiki/AppleClients#iOS-client-configuration">https://wiki.strongswan.org/projects/strongswan/wiki/AppleClients#iOS-client-configuration</a></p>

<p><a href="https://zh.wikipedia.org/wiki/IPsec">https://zh.wikipedia.org/wiki/IPsec</a></p>

<p><a href="https://blogs.technet.microsoft.com/ianhamer/2007/02/20/an-ipsec-is-an-ipsec-is-an-ipsec-redux/">https://blogs.technet.microsoft.com/ianhamer/2007/02/20/an-ipsec-is-an-ipsec-is-an-ipsec-redux/</a></p>

<p><a href="https://zh.wikipedia.org/wiki/RADIUS">https://zh.wikipedia.org/wiki/RADIUS</a></p>

<p><a href="http://freeradius.org/">http://freeradius.org/</a></p>

<p><a href="https://wiki.archlinux.org/index.php/StrongSwan_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87">https://wiki.archlinux.org/index.php/StrongSwan_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87</a>)</p>

<p><a href="https://zh.opensuse.org/SDB:Setup_Ipsec_VPN_with_Strongswan">https://zh.opensuse.org/SDB:Setup_Ipsec_VPN_with_Strongswan</a></p>

<p><a href="https://www.kiritostudio.com/running-a-strongswan-server-with-radius-on-your-vps/">https://www.kiritostudio.com/running-a-strongswan-server-with-radius-on-your-vps/</a></p>

<p><a href="http://bao3.blogspot.com/2013/05/racoonstrongswanvpn.html">http://bao3.blogspot.com/2013/05/racoonstrongswanvpn.html</a></p>

<p><a href="https://zh.opensuse.org/index.php?title=SDB:Setup_Ipsec_VPN_with_Strongswan&amp;variant=zh">https://zh.opensuse.org/index.php?title=SDB:Setup_Ipsec_VPN_with_Strongswan&amp;variant=zh</a></p>

<p><a href="https://www.gitbook.com/book/akagi201/freeradius-beginners-guide/details">https://www.gitbook.com/book/akagi201/freeradius-beginners-guide/details</a></p>

<p><a href="https://wiki.strongswan.org/projects/strongswan/wiki/AppleClients">https://wiki.strongswan.org/projects/strongswan/wiki/AppleClients</a></p>

<p><a href="https://github.com/quericy/one-key-ikev2-vpn/issues/36#issuecomment-240609434">https://github.com/quericy/one-key-ikev2-vpn/issues/36#issuecomment-240609434</a></p>

<p><a href="https://sourceforge.net/p/daloradius/discussion/684101/">https://sourceforge.net/p/daloradius/discussion/684101/</a></p>

<p><a href="http://pig.made-it.com/AAA.html">http://pig.made-it.com/AAA.html</a></p></article>
    <footer class="post-footer">
      
      <ul class="post-tags">
        
          <li><a href="https://aliasmee.github.io/tags/ikev2"><span class="tag">Ikev2</span></a></li>
        
          <li><a href="https://aliasmee.github.io/tags/vpn"><span class="tag">Vpn</span></a></li>
        
          <li><a href="https://aliasmee.github.io/tags/strongswan"><span class="tag">Strongswan</span></a></li>
        
          <li><a href="https://aliasmee.github.io/tags/ipsec"><span class="tag">Ipsec</span></a></li>
        
          <li><a href="https://aliasmee.github.io/tags/freeradius"><span class="tag">Freeradius</span></a></li>
        
      </ul>
      
      <p class="post-copyright">
        Â© This post is licensed under a Creative Commons Attribution-NonCommercial 4.0 International Licenseï¼Œplease give source if you wish to quote or reproduce.This post was published <strong>635</strong> days ago, content in the post may be inaccurate, even wrong now, please take risk yourself.
      </p>
    </footer>
    
      <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "aliasmee" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
    
  </section>
  <footer class="site-footer">
  <p>Â© 2017-2018 aliasmee&#39;s blog </p>
  <p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with theme <a href="https://github.com/laozhu/hugo-nuo" target="_blank">Nuo</a>.</p>
  
</footer>



<script async src="//cdn.bootcss.com/video.js/6.2.8/alt/video.novtt.min.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
      extensions: ["AMSmath.js", "AMSsymbols.js"] }
    }
  });
</script>
<script type="text/x-mathjax-config">
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  MathJax.Hub.Queue(() => {
    MathJax.Hub.getAllJax().map(v => v.SourceElement().parentNode.className += ' has-jax');
  });
</script>

<script src="https://aliasmee.github.io/js/bundle.d1288006cf.js"></script>


<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-120538012-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>





  </body>
</html>
